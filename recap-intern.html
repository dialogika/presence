<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Recap Presensi Intern| Kursus Public Speaking Dialogika</title>
  <meta name="description"
    content="Presensi Khusus Internship Dialogika" />
  <meta name="keywords" content="skill, public speaking, training, kelas, pelatihan, inhouse training" />
  <meta name="author" content="Dialogika" />

  <!-- Favicons -->
  <!-- Font Awesome CDN -->
  <link href="assets/img/favicon.webp" rel="icon">
  <link href="assets/img/apple-touch-icon.webp" rel="apple-touch-icon">

  <!-- OG Meta Tags to share -->
  <meta property="og:site_name" content="Kelas Public Speaking" />
  <meta property="og:site" content="www.dialogika.co" />
  <meta property="og:title" content="Recap Presensi Intern | Kursus Public Speaking Dialogika" />
  <meta property="og:description" content="Presensi Khusus Internship Dialogika" />
  <meta property="og:image" content="assets/img/hero-bg.webp" />
  <meta property="og:url" content="www.dialogika.co/presence" />
  <meta property="og:type" content="page" />

  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


  <!-- Vendor CSS Files -->
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap/css/bootstrap.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
  <link href="assets/vendor/swiper/swiper-bundle.css" rel="stylesheet" />
  <link href="assets/vendor/international-phone-number/intlTelInput.css" rel="stylesheet" />


  <!-- Part CSS Files -->
  <link href="assets/part/theme-counter/theme-counter.css" rel="stylesheet" />
  <link href="assets/part/testimoni-insurin/testi.css" rel="stylesheet" />
  <link href="assets/part/about-append/about.css" rel="stylesheet" />
  <link href="assets/part/cta-append/cta.css" rel="stylesheet" />
  <link href="assets/part/contact-append/contact.css" rel="stylesheet" />
  <link href="assets/part/portfolio-insurin/portfolio.css" rel="stylesheet" />
  <link href="assets/part/category/category.css" rel="stylesheet" />
  <link href="assets/part/popup-box/popup.css" rel="stylesheet" />
  <link href="assets/part/modals/modal.css" rel="stylesheet" />
  <link href="assets/part/smooth-slider/smooth-slider.css" rel="stylesheet" />
  <link href="assets/part/read-more/read-more_less.css" rel="stylesheet" />


  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet" />

  <!--  ========================================================  -->
  <!-- Spreadsheet API Form Pendaftaran -->
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
    crossorigin="anonymous"></script>
  <script>
    function HeroForm() {
      $.ajax({
        url: "https://api.apispreadsheets.com/data/JYfPTNSLW4GoVohc/",
        type: "post",
        data: $("#HeroForms").serializeArray(),
        headers: {
          accessKey: "6df7b75d348bfbdfa9684dfc76ed0053",
          secretKey: "68a998592183dc30cdc2b07576759f04"
        },
        success: function () {
          alert(" Permintaan telah di submit :)")
        },
        error: function () {
          alert("There was an error :(")
        }
      });
    }

    function SubForm() {
      $.ajax({
        url: "https://api.apispreadsheets.com/data/JYfPTNSLW4GoVohc/",
        type: "post",
        data: $("#myForm").serializeArray(),
        headers: {
          accessKey: "6df7b75d348bfbdfa9684dfc76ed0053",
          secretKey: "68a998592183dc30cdc2b07576759f04"
        },
        success: function () {
          alert("Anda Telah Mendaftar :)")
        },
        error: function () {
          alert("There was an error :(")
        }
      });
    }

    function Subcription() {
      $.ajax({
        url: "https://api.apispreadsheets.com/data/18511/",
        type: "post",
        data: $("#subcriptions").serializeArray(),
        success: function () {
          // $('#subcription-modal').modal('show');
          // open("https://link.dialogika.co/open-whatsapp-group");
          window.location.href = "https://link.dialogika.co/open-whatsapp-group";
        },
        error: function () {
          alert("There was an error :(")
        }
      });
    }
  </script>
  <!-- End Spreadsheet API Form Pendaftaran -->

  <!-- Meta Pixel Code -->
  <script>
    ! function (f, b, e, v, n, t, s) {
      if (f.fbq) return;
      n = f.fbq = function () {
        n.callMethod ?
          n.callMethod.apply(n, arguments) : n.queue.push(arguments)
      };
      if (!f._fbq) f._fbq = n;
      n.push = n;
      n.loaded = !0;
      n.version = '2.0';
      n.queue = [];
      t = b.createElement(e);
      t.async = !0;
      t.src = v;
      s = b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t, s)
    }(window, document, 'script',
      'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '916674555903437');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=916674555903437&ev=PageView&noscript=1" /></noscript>
  <!-- End Meta Pixel Code -->

  <!-- Pixel Quora -->
  <!-- DO NOT MODIFY -->
  <!-- Quora Pixel Code (JS Helper) -->
  <script>
    ! function (q, e, v, n, t, s) {
      if (q.qp) return;
      n = q.qp = function () {
        n.qp ? n.qp.apply(n, arguments) : n.queue.push(arguments);
      };
      n.queue = [];
      t = document.createElement(e);
      t.async = !0;
      t.src = v;
      s = document.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t, s);
    }(window, 'script', 'https://a.quora.com/qevents.js');
    qp('init', 'cae6711903da464ab62f03df5f66aedc');
    qp('track', 'ViewContent');
  </script>
  <noscript><img height="1" width="1" style="display:none"
      src="https://q.quora.com/_/ad/cae6711903da464ab62f03df5f66aedc/pixel?tag=ViewContent&noscript=1" /></noscript>
  <!-- End of Quora Pixel Code -->
  <script>
    qp('track', 'GenerateLead');
  </script>
  <!-- End Pixel Quora -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HV60XT856G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-148836422-2');
    gtag('config', 'G-HV60XT856G');
  </script>
  <!-- End Global site tag (gtag.js) - Google Analytics -->

  <!-- Google Tag Manager -->
  <script>
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
      });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-KGK9D6H');
  </script>
  <!-- End Google Tag Manager -->

  <!-- Hotjar Tracking Code for https://dialogika.co -->
  <script>
    (function (h, o, t, j, a, r) {
      h.hj = h.hj || function () {
        (h.hj.q = h.hj.q || []).push(arguments)
      };
      h._hjSettings = {
        hjid: 2828594,
        hjsv: 6
      };
      a = o.getElementsByTagName('head')[0];
      r = o.createElement('script');
      r.async = 1;
      r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
      a.appendChild(r);
    })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
  </script>
  <!-- End Hotjar -->
  <!--  ========================================================  -->
  <style>
      :root { --primary-blue: #0B2B6A; --light-blue: #1c84e3; --accent-gold: #f39c12; --bg-light: #f4f7f6; }
      body { background-color: var(--bg-light); font-family: 'Poppins', sans-serif; color: #333; padding: 20px; }
      .main-header { background-color: var(--primary-blue); color: white; padding: 20px; text-align: center; border-bottom: 4px solid var(--accent-gold); border-radius: 8px 8px 0 0; margin-bottom: 20px; }
      
      .month-section { background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 30px; overflow-x: auto; }
      .month-title { color: var(--primary-blue); font-weight: 700; border-left: 5px solid var(--light-blue); padding-left: 10px; margin-bottom: 15px; text-transform: uppercase; }
      
      table { width: 100%; border-collapse: collapse; font-size: 0.85rem; white-space: nowrap; }
      thead th { background-color: var(--light-blue) !important; color: #fff; text-align: center; padding: 10px; border: 1px solid #ddd; }
      .sticky-col { position: sticky; left: 0; background-color: var(--light-blue); z-index: 2; border-right: 2px solid #ddd; }
      tbody td { text-align: center; padding: 8px; border: 1px solid #eee; }
      tbody td.name-col { position: sticky; left: 0; background-color: white; z-index: 1; text-align: left; font-weight: 600; border-right: 2px solid #eee; color: var(--primary-blue); }
      
      /* SYMBOLS */
      .status-hadir { color: #2ecc71; font-weight: 900; font-size: 1.2rem; cursor: pointer; }
      .status-izin { color: #f1c40f; font-weight: 900; font-size: 1.2rem; }
      .status-alpha { color: #e74c3c; font-weight: 900; font-size: 1rem; }
      
      /* BADGES */
      .bg-score-high { background-color: #2ecc71; color: white; }
      .bg-score-mid { background-color: #f1c40f; color: black; }
      .bg-score-low { background-color: #e74c3c; color: white; }
      .loading-container { text-align: center; padding: 50px; }
      .modal-header { background-color: var(--primary-blue); color: white; }
  </style>
</head>

<body>

  <

  <!-- ======= Top Bar, Header, Side Bar ======= -->
  <main-header style=";"></main-header>
  <!-- ======= Top Bar, Header, Side Bar ======= -->

  <!-- ======= Breadcrumbs Section ======= -->
  <section class="breadcrumbs" style="margin-top: 110px;">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center" >
        <h2>Recap Internship Presence</h2>
        <ol>
          <li><a href="../index.html">Home</a></li>
          <li><a href="index.html">Presence</a></li>
          <li><a href="intern.html">Internship</a></li>
          <li><a href="recap-intern.html">Recap</a></li>
        </ol>
      </div>

    </div>
  </section><!-- End Breadcrumbs Section -->

  <main id="main">
      <div class="container-fluid p-0">
          

          <div id="loading" class="loading-container">
              <div class="spinner-border text-primary" role="status"></div>
              <p class="mt-2 text-muted">Sinkronisasi Data...</p>
          </div>

          <div id="recapContainer"></div>
      </div>

      <!-- MODAL -->
      <div class="modal fade" id="detailModal" tabindex="-1">
          <div class="modal-dialog modal-sm modal-dialog-centered">
              <div class="modal-content">
                  <div class="modal-header">
                      <h6 class="modal-title fw-bold">Detail Kehadiran</h6>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body text-center">
                      <div class="mb-3">
                          <small class="text-muted">Jam Masuk</small>
                          <h2 class="fw-bold text-dark" id="modalTime">--:--</h2>
                      </div>
                      <div>
                          <small class="text-muted">Durasi Kerja</small>
                          <h4 class="fw-bold" id="modalDuration">-- Jam</h4>
                          <div id="modalDurationBadge" class="badge mt-1"></div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script>
          // URL SCRIPT ANDA
          const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFttNhZ4TrtN2UWBR_z5aE-z1TGjG15Gf-UATwDe9Gefid4Qi5zL_Mv514es9DMS7cyw/exec";
          const API_URL = SCRIPT_URL + "?action=rekap";

          document.addEventListener("DOMContentLoaded", async function() {
              try {
                  const response = await fetch(API_URL);
                  const result = await response.json();
                  
                  if (result.type === "rekap") {
                      processData(result.data);
                  } else {
                      alert("Error: " + JSON.stringify(result));
                  }
              } catch (error) {
                  document.getElementById('loading').innerHTML = `<p class="text-danger">Gagal memuat data.</p>`;
              }
          });

          function processData(logs) {
              const dataByMonth = {};
              
              // Format Tanggal ISO: yyyy-MM-dd
              // Kita group berdasarkan yyyy-MM
              logs.forEach(log => {
                  // Backend sudah kirim format yyyy-MM-dd, jadi aman
                  const dateParts = log.date.split('-'); // [2025, 12, 01]
                  
                  if(dateParts.length === 3) {
                      const monthKey = `${dateParts[0]}-${dateParts[1]}`; // yyyy-MM (2025-12)
                      
                      if (!dataByMonth[monthKey]) dataByMonth[monthKey] = [];
                      dataByMonth[monthKey].push(log);
                  }
              });

              // Tambahkan Bulan Ini (Current Month) jika belum ada
              const now = new Date();
              const currentMonthKey = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
              if (!dataByMonth[currentMonthKey]) dataByMonth[currentMonthKey] = [];

              // Render
              const container = document.getElementById('recapContainer');
              container.innerHTML = "";
              const sortedMonths = Object.keys(dataByMonth).sort().reverse();

              sortedMonths.forEach(monthKey => {
                  const [year, month] = monthKey.split('-').map(Number);
                  const tableHTML = generateTable(year, month, dataByMonth[monthKey]);
                  container.innerHTML += tableHTML;
              });

              document.getElementById('loading').style.display = 'none';
          }

          function generateTable(year, month, logs) {
              const dateObj = new Date(year, month - 1, 1);
              const monthName = dateObj.toLocaleString('en-US', { month: 'long', year: 'numeric' });
              const workDays = getWorkDays(year, month);

              const employees = {};
              logs.forEach(log => {
                  if (!employees[log.name]) employees[log.name] = {};
                  // log.date sudah yyyy-MM-dd
                  employees[log.name][log.date] = log;
              });

              const sortedNames = Object.keys(employees).sort();

              // HEADER
              let thead = `<thead><tr><th class="sticky-col" rowspan="2" style="min-width:200px;">Name</th>`;
              workDays.forEach(day => {
                  thead += `<th>${day.dayName}<br>${day.dateNum}</th>`;
              });
              thead += `<th rowspan="2">Total</th><th rowspan="2">Hours</th><th rowspan="2">%</th></tr></thead>`;

              // BODY
              let tbody = "<tbody>";
              if (sortedNames.length === 0) {
                  tbody = `<tr><td colspan="${workDays.length + 4}" class="text-center py-3">No data available.</td></tr>`;
              } else {
                  sortedNames.forEach(name => {
                      let row = `<tr><td class="name-col">${name}</td>`;
                      let totalHadir = 0;
                      let totalHours = 0;

                      workDays.forEach(day => {
                          // day.isoDate formatnya yyyy-MM-dd
                          const log = employees[name][day.isoDate];
                          let cellContent = "";
                          
                          if (log) {
                              if (log.status === 'Hadir') {
                                  totalHadir++;
                                  const duration = calculateDuration(log.time);
                                  totalHours += duration;
                                  cellContent = `<span class="status-hadir" onclick="showModal('${log.time}', ${duration})">✔</span>`;
                              } else if (log.status === 'Izin') {
                                  cellContent = `<span class="status-izin">▲</span>`;
                              }
                          } else {
                              if (isDatePassed(day.dateObj)) {
                                  cellContent = `<span class="status-alpha">✕</span>`;
                              } else {
                                  cellContent = `<span style="color:#ccc">-</span>`;
                              }
                          }
                          row += `<td>${cellContent}</td>`;
                      });

                      // Score
                      const passedDays = countPassedDays(workDays);
                      let percent = 0;
                      if (passedDays > 0) percent = Math.round((totalHadir / passedDays) * 100);

                      let percentClass = "bg-score-low";
                      if (percent > 75) percentClass = "bg-score-high";
                      else if (percent >= 50) percentClass = "bg-score-mid";
                      
                      let hourClass = "bg-score-low";
                      if (totalHours >= 23) hourClass = "bg-score-high";
                      else if (totalHours > 10) hourClass = "bg-score-mid";

                      row += `<td class="fw-bold">${totalHadir}</td><td><span class="badge ${hourClass}">${totalHours}</span></td><td><span class="badge ${percentClass}">${percent}%</span></td></tr>`;
                      tbody += row;
                  });
              }
              tbody += "</tbody>";

              return `<div class="month-section"><h5 class="month-title">${monthName}</h5><div class="table-responsive"><table class="table table-bordered mb-0">${thead}${tbody}</table></div></div>`;
          }

          // UTILS
          function getWorkDays(year, month) {
              const days = [];
              const date = new Date(year, month - 1, 1);
              while (date.getMonth() === month - 1) {
                  const dayIdx = date.getDay();
                  if ([0, 2, 4, 6].includes(dayIdx)) { // Tue, Thu, Sat, Sun
                      const y = date.getFullYear();
                      const m = String(date.getMonth() + 1).padStart(2, '0');
                      const d = String(date.getDate()).padStart(2, '0');
                      days.push({
                          dateObj: new Date(date),
                          isoDate: `${y}-${m}-${d}`, // Format yyyy-MM-dd
                          dateNum: d,
                          dayName: date.toLocaleDateString('en-US', { weekday: 'short' })
                      });
                  }
                  date.setDate(date.getDate() + 1);
              }
              return days;
          }

          function calculateDuration(timeStr) {
              if (!timeStr || timeStr === "-") return 0;
              const hourIn = parseInt(timeStr.split(':')[0]);
              let dur = 17 - hourIn;
              if (dur < 0) dur = 0;
              return dur;
          }

          function isDatePassed(dateObj) {
              const now = new Date();
              now.setHours(0,0,0,0);
              return dateObj < now;
          }

          function countPassedDays(workDays) {
              const now = new Date();
              let count = 0;
              workDays.forEach(d => {
                  const endOfToday = new Date();
                  endOfToday.setHours(23,59,59);
                  if (d.dateObj <= endOfToday) count++;
              });
              return count;
          }

          function showModal(time, duration) {
              document.getElementById('modalTime').innerText = time;
              document.getElementById('modalDuration').innerText = duration + " Jam";
              const badge = document.getElementById('modalDurationBadge');
              if(duration < 4) { badge.className = "badge bg-warning text-dark"; badge.innerText = "Kurang (Low)"; }
              else { badge.className = "badge bg-success"; badge.innerText = "Cukup (Good)"; }
              new bootstrap.Modal(document.getElementById('detailModal')).show();
          }
      </script>
  </main><!-- End #main -->

  <!-- ======= Footer & Counter Area ======= -->
  <main-footer></main-footer>
  <!-- ======= End Footer & Counter Area ======= -->

  <footer-modal></footer-modal>

  <a href="#exampleModal" data-bs-toggle="modal" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bx bxl-whatsapp bx-tada"></i></a>

  <!-- Modal 2 -->
  <div class="modal popup-box fade" id="exampleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog popup-box-dialog modal-dialog-centered">
      <div class="modal-content popup-box-content">
        <div class="popup-card" style="width:100%">
          <button type="button" class="btn popup2-btn ms-auto" data-bs-dismiss="modal"><i
              class="fa-solid fa-xmark"></i></button>
          <img src="assets/img/shape/popup.jpg" class="card-img-top" alt=""
            style="border-top-left-radius: 20px;border-top-right-radius: 20px;border:0px;">
          <div class="card-body popup-card-body">

          </div>
          <form action="javascript:void" method="post" id="heroForm" enctype="text/plain" class="popup-form">
            <div class="row gy-3 mb-3">
              <div class="col-lg-6">
                <label for="names" class="form-label">Full Name</label>
                <input type="text" name="Name" class="form-control" id="names" pattern="[a-zA-Z\s]{3,100}"
                  placeholder="Nama Lengkap*" required>
              </div>
              <div class="col-lg-6">
                <label for="locations" class="form-label">Lokasi</label>
                <input type="text" class="form-control" name="Location" id="locations" pattern="[a-zA-Z\s]{3,100}"
                  placeholder="Kota*" required>
              </div>
              <div class="col-lg-6">
                <label for="whatsapps" class="form-label">Whatsapp</label>
                <input type="tel" class="form-control" name="Whatsapp" id="whatsapps" pattern="[0-9]{10,15}"
                  placeholder="Whatsapp*" required="">
              </div>
              <div class="col-lg-6">
                <label for="events" class="form-label">Needs</label>
                <input type="text" name="Event" class="form-control" id="events" placeholder="Kebutuhan">
              </div>
              <select class="d-none" name="Timestamp">
                <option id="timestamp"></option>
              </select>
            </div>
            <button class="custom-btn2 send_contact" id="submits" onclick="HeroForm()">Send Whatsapp</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Part JS Files -->
  <script src="assets/part/modals/modal-component.js"></script>
  <script src="assets/part/smooth-slider/smooth-slider.js"></script>
  <script src="assets/part/whatsapp/whatsapp.js"></script>
  <script src="assets/part/read-more/read-more_less.js"></script>


  <!-- Vendor JS Files -->
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/international-phone-number/script.js"></script>
  <script src="assets/vendor/international-phone-number/intlTelInput.min.js"></script>


  <!-- Template Main JS File -->
  <script src="assets/js/headerfooter.js"></script>
  <script src="assets/js/timestamp.js"></script>
  <!-- <script src="assets/js/whatsapp.js"></script> -->
  <script src="assets/js/clickup-task.js"></script>
  <script src="assets/js/main.js"></script>


</body>

</html>
